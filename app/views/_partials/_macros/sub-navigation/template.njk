<nav class="app-subnav{% if params.classes %} {{ params.classes }}{% endif %}" aria-label="{{params.pageTitle}}" role="navigation">
  <h2 class="govuk-visually-hidden" id="app-subnav-heading">Pages in this section</h2>
  {% if params.sectionId === 'patterns' %}
    <h2 class="app-subnav__theme">Help users to...</h2>
  {% endif %}
  {% for item in params.navItems %}
    {% if item.id === params.sectionId %}
      {% for pageSubsection in item.subsections %}
        {% if pageSubsection.sectionHeading !== '' %}
          <h4 class="app-subnav__theme">
            {{pageSubsection.sectionHeading}}
          </h4>
        {% endif %}
        <ul class="app-subnav__section">
          {% for subItem in pageSubsection.subsections %}
            {% set current = (subItem.id === params.pageId) %}
            <li class="app-subnav__section-item{{' app-subnav__section-item--current' if current }}">
              <a class="govuk-link govuk-link--no-visited-state govuk-link--no-underline app-subnav__link" href="{{subItem.link}}"{% if current %} aria-current="location"{% endif %}>
                {{subItem.title}}
              </a>
              {% if current and (subItem.subsections.length > 0) %}
                <ul class="app-subnav__section app-subnav__section--nested">
                  {% for subItem in subItem.subsections %}
                    <li class="app-subnav__section-item">
                      <a class="govuk-link govuk-link--no-visited-state govuk-link--no-underline app-subnav__link" href="{{subItem.link}}">
                        {{subItem.title}}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% endfor %}
    {% endif %}
  {% endfor %}
</nav>
